{#
# This file is part of Invenio.
# Copyright (C) 2015 CERN.
#
# Invenio is free software; you can redistribute it and/or
# modify it under the terms of the GNU General Public License as
# published by the Free Software Foundation; either version 2 of the
# License, or (at your option) any later version.
#
# Invenio is distributed in the hope that it will be useful, but
# WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
# General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with Invenio; if not, write to the Free Software Foundation, Inc.,
# 59 Temple Place, Suite 330, Boston, MA 02111-1307, USA.
#}

{%- import "accounts/settings/helpers.html" as helpers with context -%}
{%- from "communities/helpers.html" import searchbar with context -%}
{%- from "communities/helpers.html" import emptyprompt with context -%}
{%- from "paginate.html" import paginate with context -%}
{%- from "paginate.html" import list_status with context -%}

{%- extends "accounts/settings/index.html" -%}

{%- bundles "communities.css" -%}

{%- block settings_body %}
{{ helpers.panel_start(
    _("My Communities"),
    with_body=False,
    icon="fa fa-users fa-fw",
    btn=_("New community") if communities.items|length > 0 else "", btn_icon='fa fa-fw fa-plus', btn_href=url_for('communities_settings.new')
   ) }}
<div class="panel-body">  <!-- TODO: Hard coded/Configurable view description -->
  {%- block mycommunities_description %}
  <div style="line-height: 25px;"><strong>Your own, tailor-made repositories.</strong> Communities allow you to keep all your uploads under one roof and control access to your data.
  Whether it is to represent your organisation or you just need a space for your private publications, communities would come in handy.
  Additionally you will be able to divide work among community <em>members</em> by assigning them to a specific <em>teams</em> (laveraging team-based access permissions).</div>
  {%- endblock mycommunities_description %}
</div>
{%- if communities.items|length == 0 %}
{{ emptyprompt(
    btn=_('New community'), btn_icon='fa fa-fw fa-plus',
    btn_href=url_for('communities_settings.new'),
    heading=_('Go ahead and create new community !'), footer=_('Sugar, spice and everything nice.')
   ) }}
{%- else %}
{{ searchbar() }}
<table class="table table-hover table-striped">
  <thead>
    <tr>
      <th class="col-md-6">{{ _("Title") }}</th>
      <th class="col-md-2 text-center">{{ _("Teams") }}</th>
      <th class="col-md-4"></th>
    </tr>
  </thead>
  <tbody>
    {%- for community in communities.items %}
    <tr>
      <td>
        <div>
          <b>{{ community.title }}</b>
        </div>
        <br>
        <small>{{ community.description|truncate(200, True)|safe }}</small>
      </td>
      <td class="text-center vcenter">{{ community.teams|count }}</td>
      <td class="text-center btn-toolbar vcenter">
        <a class="btn btn-xs btn-default" href="{{community.community_url}}">
          <i class="fa fa-search fa-fw"></i>{{ _("View") }}</a>
        <a class="btn btn-xs btn-default" href="{{community.community_provisional_url}}">
          <i class="fa fa-fw fa-medkit"></i>{{ _("Curate") }}</a>
        <a class="btn btn-xs btn-default" href="{{url_for('community_manage.manage', community_id=community.id)}}">
          <i class="fa fa-wrench fa-fw"></i>{{ _("Manage") }}</a>
      </td>
    </tr>
    {%- endfor %}
  </tbody>
</table>
<ul class="list-group">
  <li class="list-group-item text-center">
    {{ list_status(communities) }}
    {{ paginate(communities, small=True) if communities.items|length }}
  </li>
</ul>
{%- endif %}
{{ helpers.panel_end(with_body=False) }}
{% endblock %}
